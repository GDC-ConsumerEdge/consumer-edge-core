{
  "category": "CUSTOM",
  "displayName": "Edge Anthos Storage Usage",
  "etag": "a6d4b0170f043e07e0ec75fe64c52190",
  "mosaicLayout": {
    "columns": 12,
    "tiles": [
      {
        "height": 4,
        "widget": {
          "title": "K8s Node Storage Allocation %",
          "xyChart": {
            "chartOptions": {
              "mode": "COLOR"
            },
            "dataSets": [
              {
                "plotType": "LINE",
                "targetAxis": "Y1",
                "timeSeriesQuery": {
                  "timeSeriesQueryLanguage": "{ t_0:\n    fetch k8s_container\n    | metric 'kubernetes.io/anthos/kube_pod_container_resource_requests'\n    | filter (metric.resource == 'ephemeral_storage')\n    | group_by 1m,\n        [value_kube_pod_container_resource_requests_mean:\n           mean(value.kube_pod_container_resource_requests)]\n    | every 1m\n    | group_by [node: metric.node],\n        [value_kube_pod_container_resource_requests_mean_aggregate:\n           aggregate(value_kube_pod_container_resource_requests_mean)]\n; t_1:\n    fetch k8s_node\n    | metric 'kubernetes.io/anthos/node_filesystem_avail_bytes'\n    | filter (metric.fstype != 'tmpfs')\n    | group_by 1m,\n        [value_node_filesystem_avail_bytes_mean:\n           mean(value.node_filesystem_avail_bytes)]\n    | every 1m\n    | group_by [node: resource.node_name],\n        [value_node_filesystem_avail_bytes_mean_aggregate:\n           aggregate(value_node_filesystem_avail_bytes_mean)] }\n| join\n| value\n    [v_0:\n       cast_units(\n         div(t_0.value_kube_pod_container_resource_requests_mean_aggregate,\n           t_1.value_node_filesystem_avail_bytes_mean_aggregate) * 100,\n         '%')]\n| top 10, v_0"
                }
              }
            ],
            "thresholds": [
              {
                "label": "",
                "targetAxis": "Y1",
                "value": 80
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "y1Axis",
              "scale": "LINEAR"
            }
          }
        },
        "width": 6,
        "xPos": 0,
        "yPos": 0
      },
      {
        "height": 4,
        "widget": {
          "title": "Top 10 Container Storage Requested Bytes",
          "xyChart": {
            "chartOptions": {
              "mode": "COLOR"
            },
            "dataSets": [
              {
                "plotType": "LINE",
                "targetAxis": "Y1",
                "timeSeriesQuery": {
                  "timeSeriesQueryLanguage": "fetch k8s_container\n| metric 'kubernetes.io/anthos/kube_pod_container_resource_requests'\n| filter (metric.resource == 'ephemeral_storage')\n| group_by 1m,\n    [value_kube_pod_container_resource_requests_mean:\n       mean(value.kube_pod_container_resource_requests)]\n| every 1m\n| top 10\n| group_by\n    [metric.container, metric.namespace, metric.node, metric.pod, metric.unit,\n     resource.location, resource.cluster_name, resource.namespace_name,\n     resource.pod_name, resource.container_name],\n    [value_kube_pod_container_resource_requests_mean_aggregate:\n       aggregate(value_kube_pod_container_resource_requests_mean)]"
                }
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "y1Axis",
              "scale": "LINEAR"
            }
          }
        },
        "width": 6,
        "xPos": 0,
        "yPos": 8
      },
      {
        "height": 4,
        "widget": {
          "title": "K8s Node Disk Usage %",
          "xyChart": {
            "chartOptions": {
              "mode": "COLOR"
            },
            "dataSets": [
              {
                "plotType": "LINE",
                "targetAxis": "Y1",
                "timeSeriesQuery": {
                  "timeSeriesQueryLanguage": "{ t_0:\n    fetch k8s_node\n    | metric 'kubernetes.io/anthos/node_filesystem_avail_bytes'\n    | filter (metric.fstype != 'tmpfs')\n    | group_by 1m,\n        [value_node_filesystem_avail_bytes_mean:\n           mean(value.node_filesystem_avail_bytes)]\n    | every 1m\n    | group_by [device: metric.device, node: resource.node_name],\n        [value_node_filesystem_avail_bytes_mean_aggregate:\n           aggregate(value_node_filesystem_avail_bytes_mean)]\n; t_1:\n    fetch k8s_node\n    | metric 'kubernetes.io/anthos/node_filesystem_size_bytes'\n    | filter (metric.fstype != 'tmpfs')\n    | group_by 1m,\n        [value_node_filesystem_size_bytes_mean:\n           mean(value.node_filesystem_size_bytes)]\n    | every 1m\n    | group_by [device: metric.device, node: resource.node_name],\n        [value_node_filesystem_size_bytes_mean_aggregate:\n           aggregate(value_node_filesystem_size_bytes_mean)] }\n| join\n| value\n    [v_0:\n       cast_units(\n         div(\n           sub(t_1.value_node_filesystem_size_bytes_mean_aggregate,\n             t_0.value_node_filesystem_avail_bytes_mean_aggregate),\n           t_1.value_node_filesystem_size_bytes_mean_aggregate) * 100,\n         '%')]"
                }
              }
            ],
            "thresholds": [
              {
                "label": "",
                "targetAxis": "Y1",
                "value": 80
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "y1Axis",
              "scale": "LINEAR"
            }
          }
        },
        "width": 6,
        "xPos": 6,
        "yPos": 0
      },
      {
        "height": 4,
        "widget": {
          "title": "K8s Node Filesystem Size Bytes",
          "xyChart": {
            "chartOptions": {
              "mode": "COLOR"
            },
            "dataSets": [
              {
                "plotType": "LINE",
                "targetAxis": "Y1",
                "timeSeriesQuery": {
                  "timeSeriesQueryLanguage": "fetch k8s_node\n| metric 'kubernetes.io/anthos/node_filesystem_files'\n| filter (metric.fstype != 'tmpfs')\n| group_by 1m,\n    [value_node_filesystem_files_mean: mean(value.node_filesystem_files)]\n| every 1m\n| top 10\n| group_by\n    [metric.device, metric.fstype, metric.mountpoint, resource.project_id,\n     resource.location, resource.cluster_name, resource.node_name],\n    [value_node_filesystem_files_mean_aggregate:\n       aggregate(value_node_filesystem_files_mean)]"
                }
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "y1Axis",
              "scale": "LINEAR"
            }
          }
        },
        "width": 6,
        "xPos": 0,
        "yPos": 4
      },
      {
        "height": 4,
        "widget": {
          "title": "Host Disk Usage Bytes",
          "xyChart": {
            "chartOptions": {
              "mode": "COLOR"
            },
            "dataSets": [
              {
                "minAlignmentPeriod": "60s",
                "plotType": "LINE",
                "targetAxis": "Y1",
                "timeSeriesQuery": {
                  "apiSource": "DEFAULT_CLOUD",
                  "timeSeriesFilter": {
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "crossSeriesReducer": "REDUCE_SUM",
                      "groupByFields": [
                        "metric.label.\"device\"",
                        "resource.label.\"instance_id\"",
                        "resource.label.\"zone\""
                      ],
                      "perSeriesAligner": "ALIGN_MEAN"
                    },
                    "filter": "metric.type=\"agent.googleapis.com/disk/bytes_used\" resource.type=\"gce_instance\" metric.label.\"state\"=\"used\" metric.label.\"device\"!=monitoring.regex.full_match(\".*loop.*\")"
                  }
                }
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "y1Axis",
              "scale": "LINEAR"
            }
          }
        },
        "width": 6,
        "xPos": 6,
        "yPos": 4
      },
      {
        "height": 4,
        "widget": {
          "title": "Container Storage Usage Bytes",
          "xyChart": {
            "chartOptions": {
              "mode": "COLOR"
            },
            "dataSets": [
              {
                "minAlignmentPeriod": "60s",
                "plotType": "LINE",
                "targetAxis": "Y1",
                "timeSeriesQuery": {
                  "apiSource": "DEFAULT_CLOUD",
                  "timeSeriesFilter": {
                    "aggregation": {
                      "alignmentPeriod": "60s",
                      "crossSeriesReducer": "REDUCE_SUM",
                      "groupByFields": [
                        "resource.label.\"location\"",
                        "resource.label.\"cluster_name\"",
                        "resource.label.\"namespace_name\"",
                        "resource.label.\"pod_name\"",
                        "resource.label.\"container_name\""
                      ],
                      "perSeriesAligner": "ALIGN_MEAN"
                    },
                    "filter": "metric.type=\"kubernetes.io/container/ephemeral_storage/used_bytes\" resource.type=\"k8s_container\""
                  }
                }
              }
            ],
            "timeshiftDuration": "0s",
            "yAxis": {
              "label": "y1Axis",
              "scale": "LINEAR"
            }
          }
        },
        "width": 6,
        "xPos": 6,
        "yPos": 8
      }
    ]
  },
  "name": "projects/277388456369/dashboards/9b21cfd2-74d0-42df-ac1d-f14c76b6e62c"
}